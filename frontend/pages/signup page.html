<!DOCTYPE html>  
<html lang="en">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1" />  
  <title>Sign up - Classmate</title>  
  <!-- Tailwind CSS CDN with dark mode config -->  
  <script src="https://cdn.tailwindcss.com"></script>  
  <script>  
    tailwind.config = {  
      darkMode: 'class',  
    }  
  </script>  
  <!-- Font Awesome for icons -->  
  <link  
    rel="stylesheet"  
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"  
  />  
  <style>  
    /* Theme toggle button styles */  
    .theme-toggle {  
      display: flex;  
      align-items: center;  
      justify-content: center;  
      width: 40px;  
      height: 40px;  
      border-radius: 50%;  
      background: rgba(255, 255, 255, 0.1);  
      border: 1px solid rgba(255, 255, 255, 0.2);  
      cursor: pointer;  
      transition: all 0.3s ease;  
      color: inherit;  
    }  
    .theme-toggle:hover {  
      background: rgba(255, 255, 255, 0.2);  
      transform: translateY(-2px);  
    }  
    .theme-toggle i {  
      font-size: 1.2rem;  
      transition: transform 0.3s ease;  
    }  
    /* Icon visibility */  
    .theme-toggle i.fa-sun {  
      display: none;  
    }  
    .dark .theme-toggle i.fa-sun {  
      display: block;  
    }  
    .dark .theme-toggle i.fa-moon {  
      display: none;  
    }  
    /* Custom styles for auth card */  
    .auth-card {  
      backdrop-filter: blur(10px);  
    }  
    /* Smooth transitions */  
    html {  
      transition: background-color 0.3s ease, color 0.3s ease;  
    }  
    /* Spinner for loading state */  
    .spinner {  
      display: inline-block;  
      width: 1em;  
      height: 1em;  
      border: 2px solid rgba(255, 255, 255, 0.3);  
      border-radius: 50%;  
      border-top-color: #fff;  
      animation: spin 1s ease-in-out infinite;  
      margin-right: 0.5em;  
      vertical-align: middle;  
    }  
    .spinner-text {  
        vertical-align: middle;  
    }  
    @keyframes spin {  
      to { transform: rotate(360deg); }  
    }  
  </style>  
</head>  
<body  
  class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans transition-colors duration-300"  
>  
  <div class="container mx-auto px-4 py-6">  
    <!-- Navigation -->  
    <nav class="flex justify-between items-center">  
      <div>  
        <a  
          href="Classmate Home BL.html"  
          class="font-bold text-xl tracking-tight dark:text-white"  
          >CLASSMATE</a  
        >  
      </div>  
      <button  
        id="themeToggle"  
        class="theme-toggle"  
        aria-label="Toggle Dark Mode"  
        type="button"  
      >  
        <i class="fas fa-sun"></i>  
        <i class="fas fa-moon"></i>  
      </button>  
    </nav>  
  </div>  
  
  <!-- Sign Up Form -->  
  <div class="flex items-center justify-center min-h-screen px-4">  
    <div  
      class="w-full max-w-lg bg-gradient-to-br from-purple-50 to-blue-50 dark:from-gray-800 dark:to-gray-700 rounded-2xl shadow-xl p-1"  
    >  
      <div  
        class="auth-card w-full bg-white dark:bg-gray-800 rounded-xl p-8 border border-gray-200 dark:border-gray-700"  
      >  
        <div class="flex justify-between items-center mb-8">  
          <h1 class="text-2xl font-bold text-gray-900 dark:text-white">  
            Join Classmate  
          </h1>  
          <p class="text-gray-600 dark:text-gray-400">  
            Have an account?  
            <a  
              href="Login page.html"  
              class="font-medium text-purple-600 dark:text-purple-400 hover:underline"  
              >Sign in</a  
            >  
          </p>  
        </div>  
  
        <form id="signup-form">  
          <div class="mb-4">  
            <label  
              for="name"  
              class="block text-gray-900 dark:text-gray-300 font-medium mb-2"  
              >Full Name</label  
            >  
            <input  
              type="text"  
              id="name"  
              placeholder="Your name"  
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-700 dark:bg-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors duration-300"  
              required  
            />  
          </div>  
  
          <div class="mb-4">  
            <label  
              for="email"  
              class="block text-gray-900 dark:text-gray-300 font-medium mb-2"  
              >Email</label  
            >  
            <input  
              type="email"  
              id="email"  
              placeholder="Email address"  
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-700 dark:bg-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors duration-300"  
              required  
            />  
          </div>  
  
          <div class="mb-4">  
            <label  
                for="password"  
                class="block text-gray-900 dark:text-gray-300 font-medium mb-2"  
                >Password</label  
            >  
            <div class="relative">  
                <input  
                    type="password"  
                    id="password"  
                    placeholder="Password (min. 8 character)"  
                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-700 dark:bg-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors duration-300 pr-10"  
                    required  
                >  
                <button type="button" id="togglePassword" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">  
                    <i class="fas fa-eye"></i>  
                </button>  
            </div>  
          </div>  
  
          <!-- Added DOB field based on Loginpage.html logic -->  
          <div class="mb-4">  
            <label  
              for="dob"  
              class="block text-gray-900 dark:text-gray-300 font-medium mb-2"  
              >Date of Birth</label  
            >  
            <input  
              type="date"  
              id="dob"  
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-700 dark:bg-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors duration-300"  
              required  
            />  
          </div>  
  
          <div class="mb-6">  
            <label class="flex items-start">  
              <input  
                type="checkbox"  
                id="terms"  
                class="form-checkbox h-5 w-5 text-purple-600 dark:text-purple-400 focus:ring-purple-500 mt-1"  
                required  
              />  
              <span class="ml-2 text-gray-900 dark:text-gray-300"  
                >I agree with  
                <a  
                  href="#"  
                  class="font-medium text-purple-600 dark:text-purple-400 hover:underline"  
                  >Terms & Conditions</a  
                ></span  
              >  
            </label>  
          </div>  
  
          <!-- Error Message Placeholder -->  
          <div id="error-message" class="text-red-500 text-sm mt-2 mb-4" style="display: none;"></div>  
  
          <button  
            type="submit"  
            id="submit-button"  
          >  
            Create Account <i class="fas fa-arrow-right ml-2"></i>  
          </button>  
        </form>  
  
        <div  
          class="divider my-8 relative flex items-center justify-center">  
          <!-- Divider content if needed -->  
        </div>  
      </div>  
    </div>  
  </div>  
  
  <script>  
    // Redirect if already logged in  
    if (localStorage.getItem('auth_token')) {  
      window.location.href = "Class Mate Func.html";  
    }  
  
    // DOM elements  
    const signupForm = document.getElementById('signup-form');  
    const nameInput = document.getElementById('name');  
    const emailInput = document.getElementById('email');  
    const passwordInput = document.getElementById('password');  
    const dobInput = document.getElementById('dob'); // Added DOB input  
    const termsCheckbox = document.getElementById('terms');  
    const submitButton = document.getElementById('submit-button');  
    const errorMessage = document.getElementById('error-message');  
    const togglePassword = document.getElementById('togglePassword');  
    const toggleBtn = document.getElementById('themeToggle');  
    const html = document.documentElement;  
    const serverUrl = "https://classmate1-ffw7.onrender.com"; // Update with your server URL  
  
    // Show error message  
    function showError(message) {  
      errorMessage.textContent = message;  
      errorMessage.style.display = 'block';  
    }  
  
    // Handle successful auth (Registration -> Auto Login)  
    function handleAuthSuccess(token, userData) {  
      // Store the token and user data in localStorage  
      localStorage.setItem('auth_token', token);  
      if (userData && userData.name) {  
        localStorage.setItem('user_name', userData.name);  
      }  
      // Redirect to the protected page  
      window.location.href = 'Class Mate Func.html';  
    }  
  
    // --- Event Listeners ---  
  
    // Signup Form Submission  
    signupForm.addEventListener('submit', async function(e) {  
      e.preventDefault();  
      errorMessage.style.display = 'none'; // Hide previous errors  
  
      if (!termsCheckbox.checked) {  
        showError('You must agree to the Terms & Conditions.');  
        return;  
      }  
  
      // Show loading state  
      const originalButtonHTML = submitButton.innerHTML;  
      submitButton.disabled = true;  
      submitButton.innerHTML = '<span class="spinner"></span><span class="spinner-text">Creating Account...</span>';  
  
      try {  
        // Registration logic  
        const name = nameInput.value;  
        const email = emailInput.value;  
        const password = passwordInput.value;  
        const dob = dobInput.value; // Get DOB value  
  
        const response = await fetch(serverUrl + '/api/register', {  
          method: 'POST',  
          headers: {  
            'Content-Type': 'application/json',  
            'Accept': 'application/json'  
          },  
          body: JSON.stringify({  
            name: name,  
            email: email,  
            password: password,  
            dob: dob // Include DOB in the request  
          })  
        });  
  
        const data = await response.json();  
  
        if (!response.ok) {  
          // Handle specific error types  
          if (data.error_type === 'email_exists') {  
            showError('Email already registered. Please log in.');  
          } else {  
            showError(data.detail || 'Registration failed');  
          }  
          return; // Stop execution if registration failed  
        }  
  
        // After successful registration, automatically log the user in  
        const loginResponse = await fetch(serverUrl + '/api/login', {  
          method: 'POST',  
          headers: {  
            'Content-Type': 'application/json',  
            'Accept': 'application/json'  
          },  
          body: JSON.stringify({ email, password }) // Use email and password for login  
        });  
  
        const loginData = await loginResponse.json();  
  
        if (!loginResponse.ok) {  
          // If auto-login fails, show message and redirect to login page  
          showError('Registration successful! Please log in manually.');  
          // Optional: redirect to login after a delay  
          setTimeout(() => {  
              window.location.href = 'ClassmateLogin.html';  
          }, 2000);  
          return;  
        }  
  
        // Handle successful auto-login  
        handleAuthSuccess(loginData.token, loginData.user);  
  
      } catch (error) {  
        showError('Network error or server issue. Please try again.');  
        console.error('Error:', error);  
      } finally {  
        // Restore button state  
        submitButton.disabled = false;  
        submitButton.innerHTML = originalButtonHTML;  
      }  
    });  
  
    // Password visibility toggle  
    togglePassword.addEventListener('click', function() {  
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';  
        passwordInput.setAttribute('type', type);  
        this.querySelector('i').classList.toggle('fa-eye');  
        this.querySelector('i').classList.toggle('fa-eye-slash');  
    });  
  
    // --- Theme Toggling Logic (Existing) ---  
    const savedTheme = localStorage.getItem('theme');  
    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;  
  
    if (savedTheme === 'dark' || (!savedTheme && systemPrefersDark)) {  
      html.classList.add('dark');  
    }  
  
    toggleBtn.addEventListener('click', () => {  
      html.classList.toggle('dark');  
      const isDark = html.classList.contains('dark');  
      localStorage.setItem('theme', isDark ? 'dark' : 'light');  
    });  
  
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {  
      if (!localStorage.getItem('theme')) {  
        html.classList.toggle('dark', e.matches);  
      }  
    });  
  
  </script>  
</body>  
</html>